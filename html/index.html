<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Load &amp; Save (Ajax) - Handsontable</title>

  <script src="js/common/jquery-1.9.0-min.js"></script>
  <script src="js/common/jquery-ui-1.9.2.min.js"></script>
  <link rel="stylesheet" href="css\jquery-ui\jquery-ui.css">

  <!-- Sidebar dependencies -->
        <link rel="stylesheet" href="css/sidebar/lib/fontello.css" />
        <link rel="stylesheet" href="css/sidebar/lib/normalize.css" />
        <link rel="stylesheet" href="css/sidebar/sidebar.css" />
  <!-- end Sidebar dependencies -->

  <!-- Handsontable dependencies-->
      <script src="js/handsontable/handsontable.full.js"></script>
      <link rel="stylesheet" media="screen" href="css/handsontable/handsontable.full.css">

      <!-- File below contains ajax function used by handsontable -->
      <script src="js/handsontable/helper.js"></script>

      <script src="js/handsontable/zeroclipboard/ZeroClipboard.js"></script>
  <!--end Handsontable dependencies -->

  <!-- jsPlumb dependencies -->
      <link rel="stylesheet" href="css/jsplumb/jsplumb.css">
      <!-- JS -->
      <script src="js/common/jquery-1.9.0-min.js"></script>
      <script src="js/common/jquery-ui-1.9.2.min.js"></script>
      <script src="js/jsplumb/external/jquery.ui.touch-punch-0.2.2.min.js"></script>
      <!-- support lib for bezier stuff -->
      <script src="js/jsplumb/lib/jsBezier-0.6.js"></script>
      <!-- event adapter -->
      <script src="js/jsplumb/lib/mottle-0.4.js"></script>
      <!-- geom functions -->
      <script src="js/jsplumb/lib/biltong-0.2.js"></script>
      <!-- jsplumb util -->
      <script src="js/jsplumb/src/util.js"></script>
      <script src="js/jsplumb/src/browser-util.js"></script>
      <!-- base DOM adapter -->
      <script src="js/jsplumb/src/dom-adapter.js"></script>
      <!-- main jsplumb engine -->
      <script src="js/jsplumb/src/jsPlumb.js"></script>
      <!-- endpoint -->
      <script src="js/jsplumb/src/endpoint.js"></script>
      <!-- connection -->
      <script src="js/jsplumb/src/connection.js"></script>
      <!-- anchors -->
      <script src="js/jsplumb/src/anchors.js"></script>
      <!-- connectors, endpoint and overlays  -->
      <script src="js/jsplumb/src/defaults.js"></script>
      <!-- bezier connectors -->
      <script src="js/jsplumb/src/connectors-bezier.js"></script>
      <!-- state machine connectors -->
      <script src="js/jsplumb/src/connectors-statemachine.js"></script>
      <!-- flowchart connectors -->
      <script src="js/jsplumb/src/connector-editors.js"></script>
      <!-- SVG renderer -->
      <script src="js/jsplumb/src/renderers-svg.js"></script>
      <!-- vml renderer -->
      <script src="js/jsplumb/src/renderers-vml.js"></script>
      <!-- common adapter -->
      <script src="js/jsplumb/src/base-library-adapter.js"></script>
      <!-- jquery jsPlumb adapter -->
      <script src="js/jsplumb/src/jquery.jsPlumb.js"></script>
      <!-- /JS -->
  <!-- end of jsPlumb dependencies -->

  <link rel="stylesheet" media="screen" href="css/main.css">

</head>
<body>

<script>
    // GLOBAL DEF
    _initialPairCount = 4;

    _default_depot_coords = {
        x:200,
        y:200
    };

    _default_weight_capacity = 1000;
    _default_load_area       = {x:100, y:100, z:100};
    _default_precise         = 5;
</script>

<div class="jsc-sidebar-content jsc-sidebar-pulled sidebar" style="z-index:999">
    <nav>
        <a href="#" class="icon-menu link-menu jsc-sidebar-trigger"></a>
        <b style="font-size:20px" class="inline">Welcome to online PDP solver!</b>
    </nav>
    <section class="container">
        <div id="header_container" >
            <input type="file" id="pdp_points_filename" />

            <button name="load" id="load">Load</button>
            <button name="save" id="save">Save</button>
            <button name="solve_gen" class="solve_button" id="solve_gen">Solve using generation</button>
            <!-- <button name="solve_branch_bound" class="solve_button" id="solve_branch_bound">Solve using branch and bound</button> -->
            <div id="console">
                Choose file and click "Load" to load data from server. Or type data by yourself
            </div>
        </div>
            <div class="demo points_container" id="points_container">
                <div class="shape pdp_point depot" data-shape="Circle" title="depot" data-point-id="0"  id="pdp_point_0" >D</div>
                <div class="shape pdp_point" data-shape="Circle" title="1"  data-point-id="1"  id="pdp_point_1" >1</div>
                <div class="shape pdp_point" data-shape="Circle" title="2"  data-point-id="2"  id="pdp_point_2" >2</div>
                <div class="shape pdp_point" data-shape="Circle" title="3"  data-point-id="3"  id="pdp_point_3" >3</div>
                <div class="shape pdp_point" data-shape="Circle" title="4"  data-point-id="4"  id="pdp_point_4" >4</div>
                <div class="shape pdp_point" data-shape="Circle" title="5"  data-point-id="5"  id="pdp_point_5" >5</div>
                <div class="shape pdp_point" data-shape="Circle" title="6"  data-point-id="6"  id="pdp_point_6" >6</div>
                <div class="shape pdp_point" data-shape="Circle" title="7"  data-point-id="7"  id="pdp_point_7" >7</div>
                <div class="shape pdp_point" data-shape="Circle" title="8"  data-point-id="8"  id="pdp_point_8" >8</div>
                <div class="shape pdp_point" data-shape="Circle" title="9"  data-point-id="9"  id="pdp_point_9" >9</div>

                <div class="shape pdp_point" data-shape="Circle" title="10" data-point-id="10" id="pdp_point_10">10</div>
                <div class="shape pdp_point" data-shape="Circle" title="11" data-point-id="11" id="pdp_point_11">11</div>
                <div class="shape pdp_point" data-shape="Circle" title="12" data-point-id="12" id="pdp_point_12">12</div>
                <div class="shape pdp_point" data-shape="Circle" title="13" data-point-id="13" id="pdp_point_13">13</div>
                <div class="shape pdp_point" data-shape="Circle" title="14" data-point-id="14" id="pdp_point_14">14</div>
                <div class="shape pdp_point" data-shape="Circle" title="15" data-point-id="15" id="pdp_point_15">15</div>
                <div class="shape pdp_point" data-shape="Circle" title="16" data-point-id="16" id="pdp_point_16">16</div>
                <div class="shape pdp_point" data-shape="Circle" title="17" data-point-id="17" id="pdp_point_17">17</div>
                <div class="shape pdp_point" data-shape="Circle" title="18" data-point-id="18" id="pdp_point_18">18</div>
                <div class="shape pdp_point" data-shape="Circle" title="19" data-point-id="19" id="pdp_point_19">19</div>

                <div class="shape pdp_point" data-shape="Circle" title="20" data-point-id="20" id="pdp_point_20">20</div>
                <div class="shape pdp_point" data-shape="Circle" title="21" data-point-id="21" id="pdp_point_21">21</div>
                <div class="shape pdp_point" data-shape="Circle" title="22" data-point-id="22" id="pdp_point_22">22</div>
                <div class="shape pdp_point" data-shape="Circle" title="23" data-point-id="23" id="pdp_point_23">23</div>
                <div class="shape pdp_point" data-shape="Circle" title="24" data-point-id="24" id="pdp_point_24">24</div>
                <div class="shape pdp_point" data-shape="Circle" title="25" data-point-id="25" id="pdp_point_25">25</div>
                <div class="shape pdp_point" data-shape="Circle" title="26" data-point-id="26" id="pdp_point_26">26</div>
                <div class="shape pdp_point" data-shape="Circle" title="27" data-point-id="27" id="pdp_point_27">27</div>
                <div class="shape pdp_point" data-shape="Circle" title="28" data-point-id="28" id="pdp_point_28">28</div>
                <div class="shape pdp_point" data-shape="Circle" title="29" data-point-id="29" id="pdp_point_29">29</div>

<!--                 <div class="shape pdp_point" data-shape="Circle" title="30" data-point-id="30" id="pdp_point_30">30</div>
                <div class="shape pdp_point" data-shape="Circle" title="31" data-point-id="31" id="pdp_point_31">31</div>
                <div class="shape pdp_point" data-shape="Circle" title="32" data-point-id="32" id="pdp_point_32">32</div>
                <div class="shape pdp_point" data-shape="Circle" title="33" data-point-id="33" id="pdp_point_33">33</div>
                <div class="shape pdp_point" data-shape="Circle" title="34" data-point-id="34" id="pdp_point_34">34</div>
                <div class="shape pdp_point" data-shape="Circle" title="35" data-point-id="35" id="pdp_point_35">35</div>
                <div class="shape pdp_point" data-shape="Circle" title="36" data-point-id="36" id="pdp_point_36">36</div>
                <div class="shape pdp_point" data-shape="Circle" title="37" data-point-id="37" id="pdp_point_37">37</div>
                <div class="shape pdp_point" data-shape="Circle" title="38" data-point-id="38" id="pdp_point_38">38</div>
                <div class="shape pdp_point" data-shape="Circle" title="39" data-point-id="39" id="pdp_point_39">39</div>

                <div class="shape pdp_point" data-shape="Circle" title="40" data-point-id="40" id="pdp_point_40">40</div>
                <div class="shape pdp_point" data-shape="Circle" title="41" data-point-id="41" id="pdp_point_41">41</div>
                <div class="shape pdp_point" data-shape="Circle" title="42" data-point-id="42" id="pdp_point_42">42</div>
                <div class="shape pdp_point" data-shape="Circle" title="43" data-point-id="43" id="pdp_point_43">43</div>
                <div class="shape pdp_point" data-shape="Circle" title="44" data-point-id="44" id="pdp_point_44">44</div>
                <div class="shape pdp_point" data-shape="Circle" title="45" data-point-id="45" id="pdp_point_45">45</div>
                <div class="shape pdp_point" data-shape="Circle" title="46" data-point-id="46" id="pdp_point_46">46</div>
                <div class="shape pdp_point" data-shape="Circle" title="47" data-point-id="47" id="pdp_point_47">47</div>
                <div class="shape pdp_point" data-shape="Circle" title="48" data-point-id="48" id="pdp_point_48">48</div>
                <div class="shape pdp_point" data-shape="Circle" title="49" data-point-id="49" id="pdp_point_49">49</div> -->
           </div>
            <script>
                jsPlumb.ready(function() {
                     // GLOBAL DEF
                    _pointsContainer = jsPlumb.getInstance({
                        Connector:"StateMachine",
                        PaintStyle:{ lineWidth:1, strokeStyle:"#ffa500"},
                        Endpoint:[ "Dot", { radius:1 } ],
                        EndpointStyle:{ fillStyle:"#ffa500" },
                        Container:"points_container"
                    });

                    var pdpPoints = jsPlumb.getSelector(".shape");

                    jsPlumb.fire("jsPlumbDemoLoaded", _pointsContainer);
                });

                function getPdpPoint(point_id) {
                    var result = $("#points_container .shape#pdp_point_" + point_id);
                    if (result.length === 0) { console.log ('Cannot get point #' + point_id)};
                    return result;
                }

                function getAllPdpPoints() {
                    return $("#points_container .shape");
                }

                function refreshDepot(x,y)
                {
                    depot = getPdpPoint(0);
                    if (x) depot.css({ 'left':Math.floor(x) });
                    if (y) depot.css({ 'top': Math.floor(y) });
                    depot.show();
                }

                function refreshAllPdpPoints(tableData)
                {
                    getAllPdpPoints().hide();

                    var halfLength = Math.floor(tableData.length / 2);
                    for(var i = 0; i < tableData.length; i++)
                    {
                        point = getPdpPoint(getPointIdFromRowNumber(i));
                        if (typeof tableData[i][1] !== 'undefined') point.css({ 'left':Math.floor(parseFloat(tableData[i][0])) });
                        if (typeof tableData[i][0] !== 'undefined') point.css({ 'top': Math.floor(parseFloat(tableData[i][1])) });

                        point.removeClass('pickup');
                        point.removeClass('delivery');
                        point.addClass((i < halfLength) ? 'pickup' : 'delivery');

                        point.show();
                    }

                    refreshDepot();
                }
            </script>

        </div>

    </section>

</div>

    <nav class="sidebar jsc-sidebar" id="jsi-nav" data-sidebar-options="">
        <div id="sidebar_container" class="container">
            <form action="" id="input_params">
                <h1>Solution data</h1>
                <p>
                    <label for="pdp_pairs_number">Pdp pairs:</label>
                    <input id="pdp_pairs_number" name="pdp_pairs_number" size="5">
                </p>
                <p>
                    <label>Precise, %</label>
                    <input id="precise" size="5">
                </p>
                <p>
                    <label>Weight capacity</label>
                    <input id="weight_capacity" size="5">
                </p>
                <p>
                    <label>Load area</label>
                    x: <input id="load_area_x" size="3">
                    y: <input id="load_area_y" size="3">
                    z: <input id="load_area_z" size="3">
                </p>
                <p>
                    <label>Depot</label>
                    X: <input id="depot_x" size="3">
                    Y: <input id="depot_y" size="3">
                </p>
            </form>
            <div id="pdp_table"></div>

          <script>
            // var
            get = function(id) {
              return document.getElementById(id);
            },
            container = get('pdp_table'),
            exampleConsole = get('console'),
            autosave = get('autosave'),
            load = get('load'),
            save = get('save');
            _filenameContainer = get('pdp_points_filename');

            pickupRenderer = function(instance, td, row, col, prop, value, cellProperties) {
              Handsontable.renderers.TextRenderer.apply(this, arguments);
              td.style.borderColor = 'green';
              td.style.borderWidth = '2px';
            };
            deliveryRenderer = function(instance, td, row, col, prop, value, cellProperties) {
              Handsontable.renderers.TextRenderer.apply(this, arguments);
              td.style.backgroundColor = 'green';
            };

            disabledRenderer = function(instance, td, row, col, prop, value, cellProperties) {
                Handsontable.renderers.TextRenderer.apply(this, arguments);
                td.style.backgroundColor = 'grey';
            }

            _hot = new Handsontable(container, {
              startRows: _initialPairCount * 2,
              startCols: 6,
              rowHeaders: true,
              colHeaders: true,
              minSpareRows: 0,
              currentRowClassName: 'currentRow',
              colHeaders: ['X', 'Y', 'box x', 'box y', 'box z', 'box weight'],
              columnSorting: true,
              // contextMenu: true,
              contextMenuCopyPaste: {
                swfPath: 'js/handsontable/zeroclipboard/ZeroClipboard.swf'
              },
              cells: function (row, col, prop) {
                if (row < (this.instance.countRows() / 2) ) {
                  this.renderer = pickupRenderer;
                }
                else
                {
                   this.renderer = deliveryRenderer;
                   if (col > 1)
                   {
                      var cellProperties = {};
                      cellProperties.readOnly = true;
                      cellProperties.renderer = disabledRenderer;
                      return cellProperties;
                   }
                }
              },
              beforeChange: function (changes, source) {
                //changes[i][0] - row number
                //changes[i][1] - column number
                //changes[i][3] - new value

                // remove all non-number symbols
                 for (var i = changes.length - 1; i >= 0; i--) {
                    if (changes[i][3]) {
                        changes[i][3] = changes[i][3].toString().replace(/[^0-9\.]/g,'');

                        // don't allow to fill box fields for delivery points
                        if ((changes[i][1] > 1) && changes[i][0] >= Math.floor(this.getData().length/2) ) // if changed cell column > 1 and this is delivery point, ..
                        {
                            changes[i][3] = '';
                        }
                    }
                 }
              },
              afterChange: function (changes, source) {
                refreshAllPdpPoints(this.getData());
                if (typeof _pointsContainer !== "undefined") {
                    _pointsContainer.detachEveryConnection();
                }

                if (changes)
                {
                    var newPairCount = Math.floor(this.getData().length/2);
                    var oldPairCount = $("#pdp_pairs_number").spinner().spinner("value" );
                    if (newPairCount != oldPairCount) {
                        $("#pdp_pairs_number").spinner().spinner("value", newPairCount);
                    }

                }
              },
              afterLoadData: function () {
                var newPairCount = Math.floor(this.getData().length/2);
                var oldPairCount = $("#pdp_pairs_number").spinner().spinner("value" );
                if (newPairCount != oldPairCount) {
                    $("#pdp_pairs_number").spinner().spinner("value", newPairCount);
                }

                refreshAllPdpPoints(this.getData());
              },
              afterSelectionEndByProp: function (row, col) {
                getAllPdpPoints().removeClass('highlighted');
                getPdpPoint(getPointIdFromRowNumber(row)).addClass('highlighted');
              }

            });

            loadJsonToTable = function(table, file) {
              if (file) {
                var reader = new FileReader();
                reader.onload = function() {
                    try {
                        var data = JSON.parse(this.result);

                        // GLOBAL DEF
                        _lastLoadedData = data.data;

                        exampleConsole.innerHTML = 'Data loaded';
                        // console.log(_lastLoadedData.slice(0));
                        table.loadData(_lastLoadedData.slice(0));
                    }
                    catch (e) {
                        exampleConsole.innerHTML = 'Data is incorrect. <br/>' + e;
                    }
                  };

                  reader.readAsText(file);
                }
            };

            loadJsonFromFileContainerToMainTable = function(){
                loadJsonToTable(_hot, _filenameContainer.files[0]);
            };

            Handsontable.Dom.addEvent(load, 'click', function(){
                loadJsonFromFileContainerToMainTable();
            });

            Handsontable.Dom.addEvent(save, 'click', function() {
              // // save all cell's data
              ajax('json/save.json', 'GET', JSON.stringify({data: _hot.getData()}), function (res) {
                var response = JSON.parse(res.response);

                if (response.result === 'ok') {
                  exampleConsole.innerHTML = 'Data saved';
                }
                else {
                  exampleConsole.innerHTML = 'Save error';
                }
              });
            });

            function getPointIdFromRowNumber (rowNumber) {
                return rowNumber + 1;
            };

            function getPointPositionsFromTableDataChanges(changes) {
                var positions = [];
                for (var i = 0; i < changes.length; i++) {
                    // if column with point coordinates changed
                    if ((changes[i][1] === 0) || (changes[i][1] === 1))
                    {
                        dimension = (changes[i][1] === 0) ? 'left' : 'top';
                        positions[i] = {'point_id': getPointIdFromRowNumber(changes[i][0])};
                        positions[i][dimension] = parseFloat(changes[i][3]);
                    }
                }

                return positions;
            };


            function getRandomBetween(min, max)
            {
                return Math.random() * (max - min) + min;
            }

            function fillTableRowWithRandomValues(table,rowNumber, fillOnlyCoords)
            {
                var minRandomCoord     = 10;
                var maxRandomCoord     = 500;
                var minRandomBoxSize   = 1;
                var maxRandomBoxSize   = 20;
                var minRandomBoxWeight = 1;
                var maxRandomBoxWeight = 20;

                // coords
                table.setDataAtCell(rowNumber, 0, getRandomBetween(minRandomCoord,maxRandomCoord).toFixed(2) );
                table.setDataAtCell(rowNumber, 1, getRandomBetween(minRandomCoord,maxRandomCoord).toFixed(2) );

                if (!fillOnlyCoords) {
                    // box dimensions
                    table.setDataAtCell(rowNumber, 2, getRandomBetween(minRandomBoxSize,maxRandomBoxSize).toFixed(2) );
                    table.setDataAtCell(rowNumber, 3, getRandomBetween(minRandomBoxSize,maxRandomBoxSize).toFixed(2) );
                    table.setDataAtCell(rowNumber, 4, getRandomBetween(minRandomBoxSize,maxRandomBoxSize).toFixed(2) );

                    // box weight
                    table.setDataAtCell(rowNumber, 5, getRandomBetween(minRandomBoxWeight,maxRandomBoxWeight).toFixed(2) );
                }
            }

            // adds or removes rows according to pairCount (number of PDP point pairs)
            function updateTablePairCount (table, newPairCount) {
                var rowCount     = table.countRows();
                var oldPairCount = Math.floor(rowCount / 2);
                var diff         = newPairCount - oldPairCount;

                if (diff === 0) {
                   return;
                }

                if (diff < 0) {
                    table.alter('remove_row', rowCount - Math.abs(diff), Math.abs(diff));
                    table.alter('remove_row', newPairCount, Math.abs(diff));
                }
                if (diff > 0) {
                    table.alter('insert_row', rowCount, diff);
                    table.alter('insert_row', oldPairCount, diff);

                    // if pair number increased, and we can fill cells with already loaded points, we do this
                    // i.g., we:
                    //  - loaded 5 point pairs
                    //  - decreased number to 3
                    //  - increased number to 7
                    //  in this case, we want to add data about points 4 and 5 to table
                    //
                    // BUT we force new PDP points (points 6,7 from example above) to be empty. This is why we check 'data[data.length/2 + i]'
                        var data = (typeof _lastLoadedData == 'undefined') ? [] : _lastLoadedData;
                        for (var i = oldPairCount; i < (oldPairCount + diff); i++) {
                            // if pair 'i' (BOTH pickup and delivery) loaded, restore them to table
                            var useLoadedDataForNewRows = ((typeof data[i] !== 'undefined') && (typeof data[data.length/2 + i] !== 'undefined'));
                            if (useLoadedDataForNewRows) {
                                for (var j = 0; j < table.countCols(); j++) {
                                    table.setDataAtCell(i, j, data[i][j]);
                                    table.setDataAtCell(newPairCount + i, j, data[data.length/2 + i][j]);
                                }
                            }
                            else {
                                fillTableRowWithRandomValues(table, i);
                                fillTableRowWithRandomValues(table, newPairCount + i);
                            }
                        }
                }
                //refresh table to redraw cells
                table.loadData(table.getData().slice(0));
            }
          </script>
        </div>
    </nav>

    <script src="js/sidebar/sidebar.js"></script>

    <script>

        $(function() {
            $('#jsi-nav').sidebar({
                trigger: '.jsc-sidebar-trigger',
                scrollbarDisplay: true
            });

            $('#api-pull').on('click', function (e) {
                e.preventDefault();
                $('#jsi-nav').data('sidebar').push();
            });
            $('#api-push').on('click', function (e) {
                e.preventDefault();
                $('#jsi-nav').data('sidebar').pull();
            });

            // open sidebar at the begin
            $('#jsi-nav').data('sidebar').push();
        });
    </script>


    <script>
        // remove all non-numbers from all elements with class 'numbersOnly'
        // jQuery('.htInvalid').keyup(function () {
        //     this.value = this.value.replace(/[^0-9\.]/g,'');
        // });

        $('#pdp_points_filename').on("change", function(){ loadJsonFromFileContainerToMainTable(); });
    </script>

    <script>

        $(function() {
            // fill spinner with initial pair count
            $("#pdp_pairs_number").spinner().spinner("value", _initialPairCount);
            // fill table with random data
            for (var i = 0; i < (_initialPairCount * 2); i++) {
                fillTableRowWithRandomValues(_hot, i, (i >= _initialPairCount));
            };

            $("#pdp_pairs_number").spinner({
                min: 2,
                change: function (event, ui) {
                    var pairCount = parseInt($("#pdp_pairs_number").spinner().spinner("value"));
                    updateTablePairCount(_hot, pairCount);
                }
            });

            // attach highlight events. begin
            $( "#points_container" ).on('mouseover', ".pickup", function() {
                getPdpPoint(parseInt($(this).data("point-id")) + Math.floor(_hot.countRows()/2)).addClass('highlighted');
                $(this).addClass('highlighted');
            });

            $( "#points_container" ).on('mouseout', ".pickup", function() {
                $( ".delivery" ).removeClass('highlighted');
                $(this).removeClass('highlighted');
            });

            $( "#points_container" ).on('mouseover', ".delivery", function() {
                getPdpPoint(parseInt($(this).data("point-id")) - Math.floor(_hot.countRows()/2)).addClass('highlighted');
                $(this).addClass('highlighted');
            });

            $( "#points_container" ).on('mouseout', ".delivery", function() {
                $( ".pickup" ).removeClass('highlighted');
                $(this).removeClass('highlighted');
            });
            // attach highlight events. end

            $("#points_container").height(window.innerHeight - 140);

            $('#depot_x').change(function() {
                refreshDepot($(this).val(),undefined);
            });
            $('#depot_y').change(function() {
                refreshDepot(undefined,$(this).val());
            });

            $('#depot_x').val(_default_depot_coords.x);
            $('#depot_y').val(_default_depot_coords.y);
            $('#depot_x').trigger('change');
            $('#depot_y').trigger('change');

            $('#precise').val(_default_precise);
            $('#weight_capacity').val(_default_weight_capacity);
            $('#load_area_x').val(_default_load_area.x);
            $('#load_area_y').val(_default_load_area.y);
            $('#load_area_z').val(_default_load_area.z);
        });

        function drawPath(pointsContainer, pointsContainerId,  path) {
            pointsContainer.detachEveryConnection();
            // var pdpPoints = jsPlumb.getSelector(".shape");
            var container = document.getElementById(pointsContainerId);
            for (var i=0; i < path.length-1; i++) {
                pointsContainer.connect({
                    source: getPdpPoint(path[i]),
                    target: getPdpPoint(path[i+1]),
                    connector:"Straight",
                    overlays:["Arrow"]
                });
            };
            pointsContainer.repaintEverything();
        };

        $('.solve_button').on('click', function (e) {
            var solve_method = (e.target.id == 'solve_gen') ? 'gen' : 'branch_bound';
            var specialParams = {
              precise: $('#precise').val(),
              weight_capacity: $('#weight_capacity').val(),
              load_area: {
                x: $('#load_area_x').val(),
                y: $('#load_area_y').val(),
                z: $('#load_area_z').val()
              }
            };

            $("#console").text('Please, wait for solution ...');
            $.ajax({
                url: "../demo/solve.php",
                type: "POST",
                data: 'params=' + JSON.stringify({method: solve_method, data: _hot.getData(), specialParams:specialParams }),
                dataType: "json",
                success: function(result){
                  if (result.path)
                  {
                    $("#console").text("Best path is: " + result.path.join(' ') + " with cost " + result.path_cost + '. Additional info:' + JSON.stringify(result.info));
                    drawPath(_pointsContainer, "points_container",  result.path);
                  }
                  else
                  {
                    $("#console").text("Error: " + JSON.stringify(result));
                  }
                }
            });
        });
    </script>
</body>
</html>