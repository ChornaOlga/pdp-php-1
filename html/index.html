<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <title>Load &amp; Save (Ajax) - Handsontable</title>

  <script src="js/common/jquery-1.9.0-min.js"></script>
  <script src="js/common/jquery-ui-1.9.2.min.js"></script>


  <!-- Sidebar dependencies -->
        <link rel="stylesheet" href="css/sidebar/lib/fontello.css" />
        <link rel="stylesheet" href="css/sidebar/lib/normalize.css" />
        <link rel="stylesheet" href="css/sidebar/sidebar.css" />
  <!-- end Sidebar dependencies -->

  <!-- Handsontable dependencies-->
      <script src="js/handsontable/handsontable.full.js"></script>
      <link rel="stylesheet" media="screen" href="css/handsontable/handsontable.full.css">

      <!-- File below contains ajax function used by handsontable -->
      <script src="js/handsontable/helper.js"></script>

      <script src="js/handsontable/highlight.pack.js"></script>
  <!--end Handsontable dependencies -->

  <!-- jsPlumb dependencies -->
      <link rel="stylesheet" href="css/jsplumb/jsplumb.css">
      <!-- JS -->
      <script src="js/common/jquery-1.9.0-min.js"></script>
      <script src="js/common/jquery-ui-1.9.2.min.js"></script>
      <script src="js/jsplumb/external/jquery.ui.touch-punch-0.2.2.min.js"></script>
      <!-- support lib for bezier stuff -->
      <script src="js/jsplumb/lib/jsBezier-0.6.js"></script>
      <!-- event adapter -->
      <script src="js/jsplumb/lib/mottle-0.4.js"></script>
      <!-- geom functions -->
      <script src="js/jsplumb/lib/biltong-0.2.js"></script>
      <!-- jsplumb util -->
      <script src="js/jsplumb/src/util.js"></script>
      <script src="js/jsplumb/src/browser-util.js"></script>
      <!-- base DOM adapter -->
      <script src="js/jsplumb/src/dom-adapter.js"></script>
      <!-- main jsplumb engine -->
      <script src="js/jsplumb/src/jsPlumb.js"></script>
      <!-- endpoint -->
      <script src="js/jsplumb/src/endpoint.js"></script>
      <!-- connection -->
      <script src="js/jsplumb/src/connection.js"></script>
      <!-- anchors -->
      <script src="js/jsplumb/src/anchors.js"></script>
      <!-- connectors, endpoint and overlays  -->
      <script src="js/jsplumb/src/defaults.js"></script>
      <!-- bezier connectors -->
      <script src="js/jsplumb/src/connectors-bezier.js"></script>
      <!-- state machine connectors -->
      <script src="js/jsplumb/src/connectors-statemachine.js"></script>
      <!-- flowchart connectors -->
      <script src="js/jsplumb/src/connector-editors.js"></script>
      <!-- SVG renderer -->
      <script src="js/jsplumb/src/renderers-svg.js"></script>
      <!-- vml renderer -->
      <script src="js/jsplumb/src/renderers-vml.js"></script>
      <!-- common adapter -->
      <script src="js/jsplumb/src/base-library-adapter.js"></script>
      <!-- jquery jsPlumb adapter -->
      <script src="js/jsplumb/src/jquery.jsPlumb.js"></script>
      <!-- /JS -->
  <!-- end of jsPlumb dependencies -->

  <link rel="stylesheet" media="screen" href="css/main.css">

</head>
<body>

<div class="jsc-sidebar-content jsc-sidebar-pulled sidebar" style="z-index:999">
    <nav>
        <a href="#" class="icon-menu link-menu jsc-sidebar-trigger"></a>
        <h1 class="inline">Welcome to online PDP solver!</h1>
    </nav>
    <section>

        <div id="content_container" class="container">
            <div class="demo perimeter-demo" id="points_container">
                <div class="shape" data-shape="Circle" title="122"></div>
                <div class="shape" data-shape="Circle" title="122"></div>
                <div class="shape" data-shape="Circle" title="122"></div>
                <div class="shape" data-shape="Circle" title="122"></div>
                <div class="shape" data-shape="Circle" title="122"></div>
            </div>
            <script src="js/jsplumb/demo.js"></script>

        </div>

    </section>

<!--     <section  style="background-color:blue">
    dsfadsfbr <br>  dfsd
    </section> -->

</div>

    <nav class="sidebar jsc-sidebar" id="jsi-nav" data-sidebar-options="">
        <div id="sidebar_container" class="container">
          <p>
            <input type="file" id="pdp_points_filename" />

            <button name="load" id="load">Load</button>
            <button name="save" id="save">Save</button>
          </p>

          <div id="console" >
              Click "Load" to load data from server
          </div>

          <div id="example1"></div>

          <script>
            // var
            get = function(id) {
              return document.getElementById(id);
            },
            container = get('example1'),
            exampleConsole = get('console'),
            autosave = get('autosave'),
            load = get('load'),
            save = get('save');
            filenameContainer = get('pdp_points_filename');

            hot = new Handsontable(container, {
              startRows: 10,
              startCols: 6,
              rowHeaders: true,
              colHeaders: true,
              minSpareRows: 1,
              afterChange: function (change, source) {
               // alert('changed');
              }
            });

            Handsontable.Dom.addEvent(load, 'click', function() {
              var file = filenameContainer.files[0];
              if (file) {
                var reader = new FileReader();
                reader.onload = function() {
                    var data = JSON.parse(this.result);

                    exampleConsole.innerHTML = 'Data loaded';
                    hot.loadData(data.data);
                };
                reader.readAsText(file);
              }
            });

            Handsontable.Dom.addEvent(save, 'click', function() {
              // save all cell's data
              ajax('json/save.json', 'GET', JSON.stringify({data: hot.getData()}), function (res) {
                var response = JSON.parse(res.response);

                if (response.result === 'ok') {
                  exampleConsole.innerHTML = 'Data saved';
                }
                else {
                  exampleConsole.innerHTML = 'Save error';
                }
              });
            });
          </script>
        </div>
    </nav>

    <script src="js/sidebar/sidebar.js"></script>

    <script>

        $(function() {
            $('#jsi-nav').sidebar({
                trigger: '.jsc-sidebar-trigger',
                scrollbarDisplay: true,
                pullCb: function () { console.log('pull'); },
                pushCb: function () { console.log('push'); }
            });

            $('#api-pull').on('click', function (e) {
                e.preventDefault();
                $('#jsi-nav').data('sidebar').push();
            });
            $('#api-push').on('click', function (e) {
                e.preventDefault();
                $('#jsi-nav').data('sidebar').pull();
            });
        });
    </script>



</body>
</html>